
@{
    ViewBag.Title = "服务页面";
    Layout = null;
}

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>服务页面</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>WebApi</title>

    <!-- Bootstrap -->
    <link href="~/Content/ApiService/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Scripts/bootstrapValidator.css" rel="stylesheet" />
    <link href="~/Content/ApiService/css/base.css" rel="stylesheet" />
    <link href="~/Content/ApiService/css/index.css" rel="stylesheet" />
    <link href="~/Content/bootstrapTable/bootstrap-table.css" rel="stylesheet" />
    <link href="~/Content/msgJs/toastr.min.css" rel="stylesheet" />
    <script src="~/Content/ApiService/js/jquery-3.3.1.min.js"></script>
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>

    <script src="~/Content/ApiService/js/respond.min.js"></script>
    <script src="~/Content/ApiService/js/html5shiv.min.js"></script>
    <![endif]-->
    <style>
        body {
            background-color: #e4f6fa;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!--页面结构-->
    <!--头部-->
    <header class="form-header">
        <div class="container">
            <div class="row">
                <div class="form-header-in-left">

                </div>
                <div class="form-header-in-right" id="BackPrev">
                    返回上一页
                </div>
            </div>
        </div>
    </header>
    <script type="text/javascript">
        $(function () {
            $("#BackPrev").on("click", function () {
                window.history.back(-1);
            })
        })
    </script>
    <!--中间表单-->
    <div id="content" class="container">
        <div class="row">
            <section class="form-area">
                <ul id="myTab" class="nav nav-tabs">
                    <li class="active">
                        <a href="#sqzl" data-toggle="tab">
                            收取资料
                        </a>
                    </li>
                    <li>
                        <a href="#dzgl" data-toggle="tab">
                            地址管理
                        </a>
                    </li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade in active" id="sqzl">
                        <!--发件部分-->
                        <div class="form-head-line">
                            <div class="form-head-line-left">寄件人信息</div>
                            <div class="form-head-line-right"></div>
                        </div>
                        <form class="form-horizontal form-send" role="form" id="form-send">

                            <div class="form-group">
                                <label class="col-md-4  control-label" for="sName">寄件人姓名：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sName" type="text" placeholder="请输入寄件人姓名" data-validate="required:请填写寄件人姓名" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="sPhone">寄件人电话：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sPhone" type="tel" placeholder="请输入寄件人电话" data-validate="required:寄件人手机号不能为空,cs:请填写正确手机号" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="sAddress">寄件人详细地址：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sAddress" type="text" placeholder="请输入寄件地址街道/楼层/门牌号" data-validate="required:请填写寄件人地址" />
                                </div>

                            </div>

                        </form>
                        <!--收件部分-->
                        <div class="form-head-line">
                            <div class="form-head-line-left">收件人信息</div>
                            <div class="form-head-line-right"></div>
                        </div>
                        <form class="form-horizontal form-recive" role="form" id="form-recive">

                            <div class="form-group">
                                <label class="col-md-4  control-label" for="rName">收件人姓名：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rName" type="text" placeholder="请输入收件人姓名" data-validate="required:请填写收件人姓名" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="rPhone">收件人电话：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rPhone" type="tel" placeholder="请输入收件人电话" data-validate="required:收件人手机号不能为空,cs:请填写正确手机号" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="rAddress">收件人详细地址：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rAddress" type="text" placeholder="请输入收件地址街道/楼层/门牌号" data-validate="required:请填写收件人地址" />
                                </div>

                            </div>

                            <div class="form-group" style="margin-top:50px;margin-left:5px;">
                                <button type="button" id="InsertInfo" class="btn btn-submit col-md-offset-5 col-md-2">确认发件</button>
                            </div>

                        </form>
                    </div>
                    <div class="tab-pane fade" id="wddd">
                        <!--我的订单-->

                    </div>
                    <div class="tab-pane fade" id="dzgl">
                        <!--地址管理-->
                        <div class="form-head-line">
                            <div class="form-head-line-left">寄件人信息</div>
                            <div class="form-head-line-right"></div>
                        </div>
                        <form class="form-horizontal form-send" role="form" id="history-send">

                            <div class="form-group">
                                <label class="col-md-4  control-label" for="sName_m">寄件人姓名：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sName_m" type="text" placeholder="请输入寄件人姓名" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="sPhone_m">寄件人电话：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sPhone_m" type="tel" placeholder="请输入寄件人电话" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="sAddress_m">寄件人详细地址：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="sAddress_m" type="text" placeholder="请输入寄件地址街道/楼层/门牌号" />
                                </div>

                            </div>

                        </form>
                        <!--收件部分-->
                        <div class="form-head-line">
                            <div class="form-head-line-left">收件人信息</div>
                            <div class="form-head-line-right"></div>
                        </div>
                        <form class="form-horizontal form-recive" role="form" id="history-recive">

                            <div class="form-group">
                                <label class="col-md-4  control-label" for="rName_m">收件人姓名：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rName_m" type="text" placeholder="请输入收件人姓名" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="rPhone_m">收件人电话：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rPhone_m" type="tel" placeholder="请输入收件人电话" />
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-md-4 control-label" for="rAddress_m">收件人详细地址：</label>
                                <div class="col-md-6">
                                    <input class="form-control" name="rAddress_m" type="text" placeholder="请输入收件地址街道/楼层/门牌号" />
                                </div>

                            </div>

                            <div class="form-group" style="margin-top:50px;margin-left:5px;">
                                <button type="button" id="updateAddress" class="btn btn-submit col-md-offset-5 col-md-2">设为默认地址</button>
                            </div>

                        </form>
                    </div>

                </div>
            </section>
        </div>
    </div>


    <!--底部：信息-->
    <section class="info-area">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-md-6">
                    <h3 class="sp-module-title">关于公司</h3>
                    <ul class="textwidget">
                        <li>
                            <i class="fa fa-map-marker"><i class="hidden">地址</i></i>
                            <span class="wsAddress">武侯区人民南路3号来福士广场T2 27楼2704 </span>
                        </li>
                        <li><i class="fa fa-envelope"></i> <span class="wsEmail">524871852@qq.com</span></li>
                        <li><i class="fa fa-phone"></i> <span class="wsPhone">028-86202329</span></li>
                    </ul>
                </div>

                <div id="sp-bottom2" class="col-sm-4 col-md-4">
                    <h3 class="sp-module-title">公司关键词</h3>
                    <div class="tagspopular">
                        <ul class="sitekeyul">
                            <li>
                                <a>
                                    签证服务
                                </a>
                            </li>
                            <li>
                                <a>
                                    旅游服务
                                </a>
                            </li>
                            <li>
                                <a>
                                    急速办签
                                </a>
                            </li>
                            <li>
                                <a>
                                    电子商务
                                </a>
                            </li>
                            <li>
                                <a>
                                    度假规划
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer class="footer" id="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 text-center">
                    <p><span class="wsFootor">Copyright &copy;2018易去成都</span></p>
                </div>
            </div>
        </div>
    </footer>
    <div class="modal fade" id="loadingModal">
        <div style="width: 200px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-100px;margin-top:-10px">
            <div class="progress progress-striped active" style="margin-bottom: 0;">
                <div class="progress-bar" style="width: 100%;"></div>
            </div>
            <h5 style="color:black"> <strong>正在加载...请稍等！</strong> </h5>
        </div>
    </div>
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->

    <script src="~/Content/msgJs/toastr.min.js"></script>
    <script src="~/Content/ApiService/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="~/Scripts/bootstrapValidator.js"></script>
    <script src="~/Content/bootstrapTable/bootstrap-table.js"></script>
    <script src="~/Content/bootstrapTable/bootstrap-table-zh-CN.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->

    <script type="text/javascript">
        //搜索
        var active = GetQueryString("active") - 1;
        var token = GetQueryString("token");
        $(function () {
            if (token == undefined || token == "" || token == null) {
                if (confirm('非法操作，请登录授权！')) {
                    window.location.href = "/Home/Index";
                } else {
                    window.location.href = "/Home/Index";
                }
                return;
            }
            $('#myTab li:eq(' + active + ') a').tab('show');
            toastr.options.positionClass = 'toast-bottom-center';
            $("#InsertInfo").on("click", function () {
                
                $('#form-send').bootstrapValidator('validate');
                $('#form-recive').bootstrapValidator('validate');
                let bootstrapValidator_send = $("#form-send").data('bootstrapValidator').validate();
                let bootstrapValidator_recive = $("#form-recive").data('bootstrapValidator').validate();
                if (bootstrapValidator_send.isValid() && bootstrapValidator_recive.isValid()) {
                    $("#loadingModal").modal('show');
                    InsertInfo();
                    $('#loadingModal').modal('hide');
                } else {
                    return;
                }
            })
            $("#updateAddress").on("click", function () {
                $('#history-send').bootstrapValidator('validate');
                $('#history-recive').bootstrapValidator('validate');
                let bootstrapValidator_send = $("#history-send").data('bootstrapValidator').validate();
                let bootstrapValidator_recive = $("#history-recive").data('bootstrapValidator').validate();
                if (bootstrapValidator_send.isValid() && bootstrapValidator_recive.isValid()) {
                    $("#loadingModal").modal('show');
                    UpdateInfo();
                    $('#loadingModal').modal('hide');
                } else {
                    return;
                }
            })

            $('#form-send').bootstrapValidator({
                message: '无效值',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    sName: {
                        message: '发件人姓名填写错误',
                        validators: {
                            notEmpty: {
                                message: '发件人姓名不能为空'
                            }
                        }
                    },
                    sPhone: {
                        validators: {
                            notEmpty: {
                                message: '发件人手机号码不能为空'
                            },
                            stringLength: {
                                min: 11,
                                max: 11,
                                message: '请输入11位手机号码'
                            },
                            regexp: {
                                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                                message: '请输入正确的手机号码'
                            }
                        }
                    },
                    sAddress: {
                        message: '发件人地址填写错误',
                        validators: {
                            notEmpty: {
                                message: '发件人地址不能为空'
                            }
                        }
                    }
                }
            });
            $('#form-recive').bootstrapValidator({
                message: '无效值',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    rName: {
                        message: '收件人姓名填写错误',
                        validators: {
                            notEmpty: {
                                message: '收件人姓名不能为空'
                            }
                        }
                    },
                    rPhone: {
                        validators: {
                            notEmpty: {
                                message: '收件人手机号码不能为空'
                            },
                            stringLength: {
                                min: 11,
                                max: 11,
                                message: '请输入11位手机号码'
                            },
                            regexp: {
                                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                                message: '请输入正确的手机号码'
                            }
                        }
                    },
                    rAddress: {
                        message: '收件人地址填写错误',
                        validators: {
                            notEmpty: {
                                message: '收件人地址不能为空'
                            }
                        }
                    }
                }
            });

            $('#history-send').bootstrapValidator({
                message: '无效值',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    sName_m: {
                        message: '发件人姓名填写错误',
                        validators: {
                            notEmpty: {
                                message: '发件人姓名不能为空'
                            }
                        }
                    },
                    sPhone_m: {
                        validators: {
                            notEmpty: {
                                message: '发件人手机号码不能为空'
                            },
                            stringLength: {
                                min: 11,
                                max: 11,
                                message: '请输入11位手机号码'
                            },
                            regexp: {
                                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                                message: '请输入正确的手机号码'
                            }
                        }
                    },
                    sAddress_m: {
                        message: '发件人地址填写错误',
                        validators: {
                            notEmpty: {
                                message: '发件人地址不能为空'
                            }
                        }
                    }
                }
            });
            $('#history-recive').bootstrapValidator({
                message: '无效值',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    rName_m: {
                        message: '收件人姓名填写错误',
                        validators: {
                            notEmpty: {
                                message: '收件人姓名不能为空'
                            }
                        }
                    },
                    rPhone_m: {
                        validators: {
                            notEmpty: {
                                message: '手机号码不能为空'
                            },
                            stringLength: {
                                min: 11,
                                max: 11,
                                message: '请输入11位手机号码'
                            },
                            regexp: {
                                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                                message: '请输入正确的手机号码'
                            }
                        }
                    },
                    rAddress_m: {
                        message: '收件人地址填写错误',
                        validators: {
                            notEmpty: {
                                message: '收件人地址不能为空'
                            }
                        }
                    }
                }
            });
        })


        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
        function InsertInfo() {
            let sName, sPhone, sAddress, rName, rPhone, rAddress;
            sName = $("input[name=sName]").val(), sPhone = $("input[name=sPhone]").val(), sAddress = $("input[name=sAddress]").val(), rName = $("input[name=rName]").val(), rPhone = $("input[name=rPhone]").val(), rAddress = $("input[name=rAddress]").val();
            $.ajax({
                url: '/VisaInfo/InsertInfo',
                type: 'GET',
                data: {
                    token: token,
                    sName: sName,
                    sPhone: sPhone,
                    sAddress: sAddress,
                    rName: rName,
                    rPhone: rPhone,
                    rAddress: rAddress,
                },
                contentType: 'application/json',
                success: function (json) {
                    if (json.scu) {
                        //下单成功
                        toastr.success('下单成功！');
                    } else {
                        //下单失败
                        toastr.error('下单失败！');
                    }
                },
                fail: function (json) {
                    toastr.warning('网络出错！');
                }
            });
        }
        function UpdateInfo() {
            let sName, sPhone, sAddress, rName, rPhone, rAddress;
            sName = $("input[name=sName_m]").val(), sPhone = $("input[name=sPhone_m]").val(), sAddress = $("input[name=sAddress_m]").val(), rName = $("input[name=rName_m]").val(), rPhone = $("input[name=rPhone_m]").val(), rAddress = $("input[name=rAddress_m]").val();
            $.ajax({
                url: '/VisaInfo/UpdateInfo',
                type: 'GET',
                data: {
                    token: token,
                    sName: sName,
                    sPhone: sPhone,
                    sAddress: sAddress,
                    rName: rName,
                    rPhone: rPhone,
                    rAddress: rAddress,
                },
                contentType: 'application/json',
                success: function (json) {
                    if (json.scu) {
                        //下单成功
                        toastr.success('设置成功！');
                    } else {
                        //下单失败
                        toastr.error('设置失败！');
                    }
                },
                fail: function (json) {
                    toastr.warning('网络出错！');
                }
            });
        }
    </script>
</body>
</html>
